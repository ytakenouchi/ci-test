name: validation002

on:

  workflow_call:
    inputs:
      repository: 
        type: string
      path:
        type: string
    secrets:
      pat:
        required: true

#条件  
jobs:
  import_policy:
    name: validation test
    runs-on: ubuntu-latest
    steps:
      - name: 001-repo
        uses: actions/checkout@v3
      - name: "001"
        run: pwd; ls -la
      - name: 002-repo
        uses: actions/checkout@v3
        with:
          repository: ${{ inputs.repository }}
          path: ${{ inputs.path }}
          token: ${{ secrets.pat}} 
      - name: "002"
        run: |
              pwd; ls -la
      - name: "003"
        run: |
              echo "003"
              pwd
              ls -la
              mv application.yaml ./helm_chart_folder/value.yaml
              cd ./helm_chart_folder/
              pwd; ls -la
              helm version
              pwd
              helm template . > ./test.yaml
              pwd; ls -la

#              helm template -f values.yaml > ./test.yaml


#              cd ./helm_test_folder
#              pwd; ls
##              pwd; ls
#              helm template . > test.yaml

#      - name: find yaml-file
#        run: |
#          yaml_files=`find . -type f | egrep -v 'test-ok\.yaml$' | egrep '\.(yml|yaml)$'`
#          for chk_file in $yaml_files
#          do
#            ls -l $chk_file
#            conftest test --policy ./policy $chk_file
#          done
#